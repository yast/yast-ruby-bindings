#!/bin/sh

# Verify that changing a value in a sorted table works correctly.
# See https://bugzilla.opensuse.org/show_bug.cgi?id=1165388

set -u                          # unset variables are an error
MYDIR=$(dirname "$0")
# shellcheck source=/dev/null # that file is checked separately
. "$MYDIR"/tmux-uitest.sh
BASE=table_sort_wrong_cell_1165388

tmux_new_session "$MYDIR"/"$BASE".rb || exit
trap tmux_cleanup EXIT

tmux_await "Table sorting test" || exit
sleep 0.1                       # draw the rest of the screen

tmux_send_keys Enter            # activate first table row

if ! tmux_grep "name-aaa.VALUE-AAA"; then
    echo "The wrong cell was displayed, bug boo#1165388 exists"
    tmux_send_keys M-C          # &Close
    exit 1
fi

tmux_send_keys M-C              # &Close
exit 0
