#!/bin/sh

# Test https://bugzilla.suse.com/show_bug.cgi?id=1177760
# Menu items lose their hotkeys

set -u                          # unset variables are an error
MYDIR=$(dirname "$0")
# shellcheck source=/dev/null # that file is checked separately
. "$MYDIR"/tmux-uitest.sh
BUG=1177760
BASE=menu_hotkeys_$BUG

tmux_new_session "/usr/sbin/yast /usr/share/doc/packages/yast2-ycp-ui-bindings/examples/MenuBar1.rb" || exit
trap tmux_cleanup EXIT

tmux_await "File.*Edit.*View" || exit
sleep 0.1                       # draw the rest of the screen
tmux_capture_pane_to "${BASE}-1-initial"

tmux_send_keys M-V # &View
tmux_capture_pane_to "${BASE}-2-view-menu-activated"

tmux_send_keys M-N # &Normal
tmux_capture_pane_to "${BASE}-3-normal-menu-item-activated"

if ! tmux_grep "Last Event"; then
    echo "The script does not echo what it should"
    exit 1
fi

if ! tmux_grep "view_normal"; then
    echo "view_normal was not activated, bug boo#$BUG exists"
    exit 1
fi

tmux_send_keys M-Q # &Quit
exit 0
